<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Claude CADQuery Generator Example</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.3.4/dist/axios.min.js"></script>
  <script src="../dist/three-cad-viewer.js"></script>
  <style>
    :root {
      --tcv-bg-color: #ffffff;
      --tcv-border-color: #cccccc;
      --tcv-font-color: #333333;
      --tcv-input-bg-color: #f5f5f5;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --tcv-bg-color: #2d2d2d;
        --tcv-border-color: #555555;
        --tcv-font-color: #f0f0f0;
        --tcv-input-bg-color: #3d3d3d;
      }
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    
    #container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    #cad_view {
      flex: 1;
      position: relative;
    }
    
    #notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--tcv-bg-color);
      border: 1px solid var(--tcv-border-color);
      padding: 10px 20px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
      color: var(--tcv-font-color);
    }
    
    #api_key_section {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: var(--tcv-bg-color);
      border: 1px solid var(--tcv-border-color);
      padding: 15px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      color: var(--tcv-font-color);
    }
    
    #api_key_section h3 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    
    #api_key {
      width: 300px;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid var(--tcv-border-color);
      border-radius: 4px;
      background-color: var(--tcv-input-bg-color);
      color: var(--tcv-font-color);
    }
    
    #init_button {
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: bold;
    }
    
    #init_button:hover {
      background-color: #3a80d2;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="cad_view"></div>
    <div id="notification"></div>
    <div id="api_key_section">
      <h3>Claude API Integration</h3>
      <input type="password" id="api_key" placeholder="Enter your Anthropic API key" />
      <button id="init_button">Initialize Claude</button>
    </div>
  </div>

  <script>
    // Create a simple box model for initial display
    const box = {
      "objects": {
        "box": {
          "vertices": [
            [-10, -10, -10], [10, -10, -10], [10, 10, -10], [-10, 10, -10],
            [-10, -10, 10], [10, -10, 10], [10, 10, 10], [-10, 10, 10]
          ],
          "triangles": [
            [0, 1, 2], [0, 2, 3], // bottom
            [4, 6, 5], [4, 7, 6], // top
            [0, 3, 7], [0, 7, 4], // left
            [1, 5, 6], [1, 6, 2], // right
            [0, 4, 5], [0, 5, 1], // front
            [3, 2, 6], [3, 6, 7]  // back
          ],
          "colors": Array(12).fill([0.8, 0.8, 0.8, 1.0])
        }
      },
      "names": ["box"]
    };

    // Viewer configuration
    const displayOptions = {
      cadWidth: window.innerWidth,
      cadHeight: window.innerHeight,
      defaultOpacity: 1.0,
      defaultColor: [0.8, 0.8, 0.8, 1.0],
      treeWidth: 0,
      pinning: false
    };

    const renderOptions = {
      ambientIntensity: 0.75,
      directIntensity: 0.75,
      defaultOpacity: 1.0,
      defaultColor: [0.8, 0.8, 0.8, 1.0],
      grid: true,
      axes: true
    };

    const viewerOptions = {
      ortho: true,
      transparent: false,
      blackEdges: false,
      collapse: 0
    };

    // Function to handle notifications
    function handleNotification(message) {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.style.display = "block";
      
      setTimeout(() => {
        notification.style.display = "none";
      }, 3000);
    }

    // Function to handle generated code
    function handleGeneratedCode(code) {
      console.log("Generated CADQuery code:", code);
      handleNotification("CADQuery code generated! Check the console.");
    }

    // Initialize the viewer when the page loads
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("cad_view");
      const display = new Display(container, displayOptions);
      const viewer = new Viewer(display, displayOptions, handleNotification);

      // Render the initial model
      viewer.render(box, renderOptions, viewerOptions);
      
      // Integrated Anthropic API key (replace with your actual key)
      const claudeApiKey = "YOUR_ANTHROPIC_API_KEY";
      
      // Initialize the prompt box with the integrated API key
      viewer.initializePromptBox(claudeApiKey, handleGeneratedCode);
      
      // Hide the API key input section since we're using an integrated key
      document.getElementById("api_key_section").style.display = "none";
    });
  </script>
</body>
</html>
